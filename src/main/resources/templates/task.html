<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo App - Manage Your Tasks</title>

    <!-- Bootstrap CSS for responsive design and components -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons for consistent iconography -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="task.css" />
  </head>
  <body>
    <!-- ===== MAIN APPLICATION CONTAINER ===== -->
    <div class="container-fluid">
      <div class="todo-container">
        <!-- ===== APPLICATION HEADER ===== -->
        <!-- Main application title and description -->
        <header class="todo-header">
          <h1 class="display-6 fw-light">
            <!-- Application icon using Bootstrap Icons -->
            <i class="bi bi-check2-square text-primary me-2"></i>
            Spring Todo App
          </h1>
          <p class="text-muted mb-0">Stay organized and productive</p>
        </header>

        <!-- ===== ADD TASK SECTION ===== -->
        <!-- Form for creating new tasks -->
        <section class="todo-card">
          <!-- Thymeleaf form with Spring Boot integration -->
          <form
            class="add-task-form"
            action="/"
            method="post"
            onsubmit="handleFormSubmit(event)"
          >
            <div class="mb-3">
              <!-- Form label for accessibility -->
              <label for="taskInput" class="form-label fw-medium"
                >Add a new task</label
              >
              <div class="task-input-group">
                <!-- Main task input field with validation -->
                <input
                  type="text"
                  class="form-control task-input"
                  id="taskInput"
                  name="title"
                  placeholder="What needs to be done?"
                  required
                  maxlength="255"
                  autocomplete="off"
                />
                <!-- Character counter for user feedback -->
                <small class="char-counter">
                  <span id="charCount">0</span>/255
                </small>
              </div>
            </div>
            <!-- Submit button with loading state -->
            <button type="submit" class="btn btn-primary btn-add w-100">
              <!-- Button icon -->
              <i class="bi bi-plus-circle me-1"></i>
              <span class="btn-text">Add Task</span>
              <!-- Loading spinner (hidden by default) -->
              <span
                class="spinner-border spinner-border-sm d-none ms-2"
                role="status"
                aria-hidden="true"
              ></span>
            </button>
          </form>
        </section>

        <!-- ===== TASKS DISPLAY SECTION ===== -->
        <section class="tasks-section">
          <!-- Task list container (shown when tasks exist) -->
          <div th:if="${not #lists.isEmpty(tasks)}">
            <!-- Section header with task count -->
            <h2 class="h5 text-muted mb-3">
              <i class="bi bi-list-task me-1"></i>
              Your Tasks (<span th:text="${#lists.size(tasks)}">0</span>)
            </h2>

            <!-- Dynamic task list generated by Thymeleaf -->
            <div class="tasks-list">
              <!-- Individual task item (repeated for each task) -->
              <article class="task-item" th:each="task : ${tasks}">
                <div class="task-content">
                  <!-- Task information section -->
                  <div class="task-info flex-grow-1">
                    <!-- Task title with conditional completed styling -->
                    <h3
                      class="task-title"
                      th:classappend="${task.completed} ? 'completed'"
                      th:text="${task.title}"
                    >
                      Sample Task
                    </h3>
                    <!-- Completion status indicator (shown only for completed tasks) -->
                    <div class="task-status" th:if="${task.completed}">
                      <i class="bi bi-check-circle-fill"></i>
                      <span>Completed</span>
                    </div>
                  </div>

                  <!-- Task action buttons -->
                  <div class="task-actions">
                    <!-- Toggle completion button -->
                    <a
                      th:href="@{/{id}/toggle(id=${task.id})}"
                      class="btn btn-outline-success btn-task-action btn-toggle"
                      th:classappend="${task.completed} ? 'active'"
                      th:title="${task.completed} ? 'Mark as incomplete' : 'Mark as complete'"
                      onclick="handleToggle(this)"
                    >
                      <i class="bi bi-check-lg"></i>
                      <!-- Button text (hidden on small screens) -->
                      <span
                        class="d-none d-sm-inline ms-1"
                        th:text="${task.completed} ? 'Undo' : 'Done'"
                        >Toggle</span
                      >
                    </a>

                    <!-- Delete task button -->
                    <a
                      th:href="@{/{id}/delete(id=${task.id})}"
                      class="btn btn-outline-danger btn-task-action"
                      title="Delete task"
                      onclick="return confirmDelete(event)"
                    >
                      <i class="bi bi-trash"></i>
                      <!-- Button text (hidden on small screens) -->
                      <span class="d-none d-sm-inline ms-1">Delete</span>
                    </a>
                  </div>
                </div>
              </article>
            </div>
          </div>

          <!-- ===== EMPTY STATE ===== -->
          <!-- Shown when no tasks exist to guide user -->
          <div class="empty-state" th:if="${#lists.isEmpty(tasks)}">
            <i class="bi bi-clipboard-check text-muted"></i>
            <h3 class="h4 mb-2">No tasks yet</h3>
            <p class="mb-0">
              Add your first task above to get started organizing your day!
            </p>
          </div>
        </section>
      </div>
    </div>

    <!-- ===== BOOTSTRAP JAVASCRIPT ===== -->
    <!-- Bootstrap Bundle includes Popper.js for dropdowns, tooltips, etc. -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      /* ===== APPLICATION JAVASCRIPT ===== */

      // Add event listener for input changes if elements exist
      if (taskInput && charCount) {
        taskInput.addEventListener("input", function () {
          // Update character count in real-time
          charCount.textContent = this.value.length;
        });
      }

      // ===== FORM SUBMISSION HANDLER =====
      /**
       * Handles form submission with loading state
       * @param {Event} event - Form submit event
       */
      function handleFormSubmit(event) {
        // Get button elements for loading state
        const button = event.target.querySelector(".btn-add");
        const btnText = button.querySelector(".btn-text");
        const spinner = button.querySelector(".spinner-border");

        // Update button to show loading state
        if (button && btnText && spinner) {
          button.disabled = true; // Prevent double submission
          btnText.textContent = "Adding..."; // Update button text
          spinner.classList.remove("d-none"); // Show loading spinner
        }
      }

      // ===== TASK TOGGLE HANDLER =====
      /**
       * Handles task completion toggle with user feedback
       * @param {HTMLElement} element - The toggle button element
       */
      function handleToggle(element) {
        // Show success toast notification
        const toast = new bootstrap.Toast(
          document.getElementById("successToast")
        );
        toast.show();
      }

      // ===== DELETE CONFIRMATION =====
      /**
       * Shows confirmation dialog before deleting a task
       * @param {Event} event - Click event on delete button
       * @returns {boolean} - True if user confirms, false otherwise
       */
      function confirmDelete(event) {
        // Show native confirmation dialog
        if (!confirm("Are you sure you want to delete this task?")) {
          event.preventDefault(); // Cancel navigation if not confirmed
          return false;
        }
        return true;
      }

      // ===== AUTO-HIDE ALERTS =====
      /**
       * Automatically hide alert messages after 5 seconds
       */
      document.addEventListener("DOMContentLoaded", function () {
        // Get all alert elements on the page
        const alerts = document.querySelectorAll(".alert");

        // Set up auto-hide for each alert
        alerts.forEach(function (alert) {
          setTimeout(function () {
            // Use Bootstrap's Alert component to close
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 5000); // 5 second delay
        });
      });
    </script>
  </body>
</html>
